  Wed Jun 14 2006 21:12                                                                                                  Page    1







               2500 A.D. 8051 Macro Assembler  -  Version 4.03c
               ------------------------------------------------

                       Input  Filename : t10.asm
                       Output Filename : t10.obj


    1                          	;t10.asm
    2                          	;stopwatch
    3   0000                   		CHIP 8052
    4                          		.list on
    5                          	;---------------------------------------------------
    6                          	;Define byte variables...
    7          0030            	ds1:		EQU	30h	;location for displaying value on display1
    8          0031            	ds2:		EQU	31h	;location for displaying value on display2
    9          0032            	ds3:		EQU	32h	;location for displaying value on display3
   10          0033            	ds4:		EQU	33h	;location for displaying value on display4
   11                          	;
   12          0034            	dcount_1:	EQU	34h	;variable for generating delay
   13          0035            	dcount_2:	EQU	35h	;variable for generating delay
   14          0036            	dcount_3:	EQU	36h	;variable for generating delay
   15                          	;
   16          0037            	count:		EQU	37h	;
   17          0038            	scan_no:	EQU	38h	;scan number for counting interrupts and key identification
   18          0039            	dcount:		EQU	39h	;debounce count
   19          0040            	krcount:	EQU	40h	;key release count
   20          0041            	key_code:	EQU	41h	;key code
   21          0042            	cnt_1sl		EQU	42h	;1sec lower byte
   22          0043            	cnt_1sh		EQU	43h	;1sec higher byte
   23                          	;---------------------------------------------------
   24                          	;define imidiate values..
   25          0060            	top_of_stack:	EQU	60h
   26                          	;---------------------------------------------------
   27                          	
   28                          	;---------------------------------------------------
   29                          	;define bit variables here...
   30          00A0            	sl1:		REG	P2.0		;display1/row1
   31          00A1            	sl2:		REG	P2.1		;display2/row2
   32          00A2            	sl3:		REG	P2.2		;display3/row3
   33          00A3            	sl4:		REG	P2.3		;display4/row4
   34                          	;
   35          00A4            	krl1:		REG	p2.4		;key return line 1
   36          00A5            	krl2:		REG	p2.5		;key return line 2
   37          00A6            	krl3:		REG	p2.6		;key return line 3
   38          00A7            	krl4:		REG	p2.7		;key return line 4
   39                          	;----------------------------------------------------
   40          0000            	key_ready:	REG	00h		;this flag is set when key is detected (after debounce).
   41          0001            	nkp:		REG	01h		;this flag is set when no key is pressed.
   42          0002            	tb:		REG	02h		;temp bit location
   43                          	;----------------------------------------------------
   44          0003            	start_sw	REG	03h		;start stopwatch bit
   45          0004            	s1_over		REG	04h		;1sec over bit
   46          0005            	start_buzzer:	REG	05h		;buzzer bit
   47                          	;----------------------------------------------------------------------
  Wed Jun 14 2006 21:12                                                                                                  Page    2




   48   0000                   		org 	0000h
   49   0000   02 00 2C        		jmp	main
   50                          	;----------------------------------------------------------------------
   51   0003                   		org     0003h
   52   0003   32              		reti			;ljmp	isr_i0
   53                          	;
   54   000B                   		org     000bh
   55   000B   02 00 8B        		ljmp	isr_t0		;timer0 interrupt
   56                          	;
   57   0013                   		org     0013h
   58   0013   32              		reti			;ljmp    isr_i1
   59                          	;
   60   001B                   		org     001bh
   61   001B   32              		reti
   62                          		;ljmp	isr_t1		;timer1 interrupt
   63                          					;(isr_t1)baud rate for Usart
   64                          					;(...hence no Interrupt)
   65                          	;
   66   0023                   		org     0023h
   67   0023   32              	         reti
   68                          		;ljmp    isr_receive         ;Interrupt enabled only for receive.
   69                          	;
   70   002B                   		org     002bh
   71   002B   32              	         reti
   72                          		;ljmp    isr_t2
   73                          	;
   74                          	;----------------------------------------------------------------------
   75                          	
   76                          	;----------------------------------------------------------------------
   77                          	;Specification for stopwatch...
   78                          	;A --> START	;start the stopwatch from the current count.
   79                          	;B --> STOP	;stops the stopwatch current count frozen.
   80                          	;C --> RESET	;reset the stopwatch to 0000.
   81                          	;----------------------------------------------------------------------
   82   002C                   	main:
   83   002C   75 81 60        		mov	sp,#top_of_stack
   84   002F   12 00 42        		call	init		;init timer,display,etc.
   85                          	;
   86   0032   D2 AF           		setb	ea		;enable all interupts
   87                          	;
   88   0034   12 02 71        		call	test_display
   89                          	;
   90   0037   12 03 47        		call	disp_sw		;display stopwatch
   91   003A   12 02 F6        	loop:	call	get_key
   92   003D   12 03 12        		call	keyprocess
   93   0040   01 3A           		jmp	loop
   94                          	;**********************************************************
   95                          	
   96                          	
   97                          	;---------------------------------------------------
   98                          	;initialising routines done here...
   99                          	;--------------------------------------------------------------------
  100   0042                   	init:
  101                          	;--------------------------
  102   0042   12 00 74        		call	init_timer0
  103                          	;--------------------------
  104   0045   12 00 4F        		call	init_display
  Wed Jun 14 2006 21:12                                                                                                  Page    3




  105                          	;--------------------------
  106   0048   12 00 5C        		call	init_keypad
  107                          	;--------------------------
  108   004B   12 00 82        		call	init_delay_1sec
  109                          	;--------------------------
  110   004E   22              		ret
  111                          	;--------------------------------------------------------------------
  112                          	
  113                          	;---------------------------------------------------
  114   004F                   	init_display:
  115   004F   75 30 5C        		mov	ds1,#"Z"+2	;glow all segments
  116   0052   75 31 5C        		mov	ds2,#"Z"+2
  117   0055   75 32 5C        		mov	ds3,#"Z"+2
  118   0058   75 33 5C        		mov	ds4,#"Z"+2
  119   005B   22              		ret
  120                          	;---------------------------------------------------
  121                          	;---------------------------------------------------
  122   005C                   	init_keypad:
  123   005C   D2 A4           		setb	krl1
  124   005E   D2 A5           		setb	krl2
  125   0060   D2 A6           		setb	krl3
  126   0062   D2 A7           		setb	krl4
  127   0064   75 38 00        		mov	scan_no,#00d
  128   0067   75 39 21        		mov	dcount,#33d
  129   006A   75 40 20        		mov	krcount,#32d
  130   006D   C2 00           		clr	key_ready
  131   006F   C2 01           		clr	nkp
  132   0071   C2 05           		clr	start_buzzer
  133   0073   22              		ret
  134                          	;---------------------------------------------------
  135                          	;---------------------------------------------------
  136                          	
  137                          		;(89h)
  138                          		;TMOD-->GATE, C/T, M1,	M0, GATE, C/T, M1, M0, T/C (timer1,timer0)
  139                          		;init timer 0  for 1msec
  140   0074                   	init_timer0:
  141   0074   43 89 01        		orl	tmod,#01h		;t0 in 16 bit timer mode.
  142   0077   75 8A 66        		mov	tl0,#66h		;Init timer0 with count for 1msec.
  143   007A   75 8C FC        		mov	th0,#0fch		;count=0fc66h for 1msec.
  144   007D   D2 8C           		setb	tr0			;start timer 0.
  145   007F   D2 A9           	        setb	et0			;enable timer 0 Interrupt.
  146   0081   22              		ret 
  147                          	;---------------------------------------------------
  148                          	;---------------------------------------------------
  149   0082                   	init_delay_1sec:
  150   0082   75 42 E8        		mov	cnt_1sl,#0e8h
  151   0085   75 43 04        		mov	cnt_1sh,#04h
  152   0088   D2 04           		setb	s1_over
  153   008A   22              		ret
  154                          	;---------------------------------------------------
  155                          	
  156                          	;--------------------------------------------------------------------
  157   008B                   	isr_t0:
  158   008B   C0 E0           		push	a
  159   008D   C0 D0           		push	psw
  160   008F   C0 83           		push	dph
  161   0091   C0 82           		push	dpl
  Wed Jun 14 2006 21:12                                                                                                  Page    4




  162                          	
  163   0093   11 74           		call	init_timer0
  164                          	;
  165   0095   12 00 AF        		call	delay_1sec
  166                          	;	
  167   0098   12 03 54        		call	buzzer
  168                          	
  169   009B   12 00 C5        		call	scanner			;spoils a,psw,dptr
  170                          	;
  171   009E   30 04 05        		jnb	s1_over,out_isr
  172   00A1   12 02 B0        		call	inc_d
  173   00A4   C2 04           		clr	s1_over
  174                          	;
  175   00A6                   	out_isr:
  176   00A6   D0 82           		pop	dpl
  177   00A8   D0 83           		pop	dph
  178   00AA   D0 D0           		pop	psw
  179   00AC   D0 E0           		pop	a
  180   00AE   32              		reti
  181                          	
  182                          	;----------------------------------------------------------------------
  183                          	;----------------------------------------------------------------------
  184                          	;count for 1000ms (04e8h) is loaded in cnt_1sl (0e8h) and cnt_1sh (04h)
  185                          	;s1_over flag initially set.
  186   00AF                   	delay_1sec:
  187   00AF   20 04 12        		jb	s1_over,out_ds1sec
  188   00B2   D5 42 0F        		djnz	cnt_1sl,out_ds1sec
  189   00B5   D5 43 09        		djnz	cnt_1sh,reinit_1sl
  190                          	;count over..
  191   00B8   75 43 04        		mov	cnt_1sh,#04h
  192   00BB   75 42 E8        		mov	cnt_1sl,#0e8h
  193   00BE   D2 04           		setb	s1_over
  194   00C0   22              		ret	
  195   00C1                   	reinit_1sl:
  196   00C1   75 42 FF        		mov	cnt_1sl,#0ffh
  197   00C4                   	out_ds1sec:
  198   00C4   22              		ret	
  199                          	;----------------------------------------------------------------------
  200                          	;----------------------------------------------------------------------
  201   00C5                   	scanner:	
  202                          	;----------------------------------------------------------------------
  203   00C5   E5 38           		mov	a,scan_no
  204                          	;----------------------------------------------------------------------
  205                          	
  206                          	
  207                          	;-(0)------------------------------------------------------------------
  208   00C7                   	zero:
  209   00C7   B4 00 15        		cjne	a,#00d,one		;
  210                          	;----------------------------------------
  211                          	;key_output_line
  212   00CA   C2 A0           		clr	sl1			;select display/row 1
  213   00CC   D2 A1           		setb	sl2			;
  214   00CE   D2 A2           		setb	sl3			;
  215   00D0   D2 A3           		setb	sl4			;
  216                          	;----------------------------------------
  217   00D2   12 02 14        		call	adisp1
  218                          	;----------------------------------------
  Wed Jun 14 2006 21:12                                                                                                  Page    5




  219   00D5   A2 A4           		mov	c,krl1
  220   00D7   12 01 D0        		call	k
  221                          	;----------------------------------------
  222   00DA   75 38 01        		mov	scan_no,#01d
  223   00DD   21 CF           		ajmp	out_scanner
  224                          	;----------------------------------------------------------------------
  225                          	
  226                          	
  227                          	;-(1)------------------------------------------------------------------
  228   00DF                   	one:
  229   00DF   B4 01 0A        		cjne	a,#01d,two		;
  230                          	;----------------------------------------
  231                          	
  232                          	;----------------------------------------
  233   00E2   A2 A5           		mov	c,krl2
  234   00E4   12 01 D0        		call	k
  235                          	;----------------------------------------
  236   00E7   75 38 02        		mov	scan_no,#02d	
  237   00EA   21 CF           		ajmp	out_scanner
  238                          	;----------------------------------------------------------------------
  239                          	
  240                          	
  241                          	;-(2)------------------------------------------------------------------
  242   00EC                   	two:
  243   00EC   B4 02 0A        		cjne	a,#02d,three		;
  244                          	;----------------------------------------
  245                          	
  246                          	;----------------------------------------
  247   00EF   A2 A6           		mov	c,krl3
  248   00F1   12 01 D0        		call	k
  249                          	;----------------------------------------
  250   00F4   75 38 03        		mov	scan_no,#03d
  251   00F7   21 CF           		ajmp	out_scanner
  252                          	;----------------------------------------------------------------------
  253                          	
  254                          	
  255                          	
  256                          	;-(3)------------------------------------------------------------------
  257   00F9                   	three:
  258   00F9   B4 03 0D        		cjne	a,#03d,four		;
  259                          	;----------------------------------------
  260   00FC   12 02 10        		call	disp_blank
  261                          	;----------------------------------------
  262   00FF   A2 A7           		mov	c,krl4
  263   0101   12 01 D0        		call	k
  264                          	;----------------------------------------
  265   0104   75 38 04        		mov	scan_no,#04d
  266   0107   21 CF           		ajmp	out_scanner
  267                          	;----------------------------------------------------------------------
  268                          	
  269                          	
  270                          	
  271                          	;-(4)------------------------------------------------------------------
  272   0109                   	four:
  273   0109   B4 04 15        		cjne	a,#04d,five		;
  274                          	;----------------------------------------
  275                          	;key_output_line
  Wed Jun 14 2006 21:12                                                                                                  Page    6




  276   010C   D2 A0           		setb	sl1			;
  277   010E   C2 A1           		clr	sl2			;select display/row 2
  278   0110   D2 A2           		setb	sl3			;
  279   0112   D2 A3           		setb	sl4			;
  280                          	;----------------------------------------
  281   0114   12 02 20        		call	adisp2
  282                          	;----------------------------------------
  283   0117   A2 A4           		mov	c,krl1
  284   0119   12 01 D0        		call	k
  285                          	;----------------------------------------
  286   011C   75 38 05        		mov	scan_no,#05d
  287   011F   21 CF           		ajmp	out_scanner
  288                          	;----------------------------------------------------------------------
  289                          	
  290                          	
  291                          	
  292                          	;-(5)------------------------------------------------------------------
  293   0121                   	five:
  294   0121   B4 05 0A        		cjne	a,#05d,six		;
  295                          	;----------------------------------------
  296                          	
  297                          	;----------------------------------------
  298   0124   A2 A5           		mov	c,krl2
  299   0126   12 01 D0        		call	k
  300                          	;----------------------------------------
  301   0129   75 38 06        		mov	scan_no,#06d
  302   012C   21 CF           		ajmp	out_scanner
  303                          	;----------------------------------------------------------------------
  304                          	
  305                          	
  306                          	
  307                          	;-(6)------------------------------------------------------------------
  308   012E                   	six:
  309   012E   B4 06 0A        		cjne	a,#06d,seven		;
  310                          	;----------------------------------------
  311                          	
  312                          	;----------------------------------------
  313   0131   A2 A6           		mov	c,krl3
  314   0133   12 01 D0        		call	k
  315                          	;----------------------------------------
  316   0136   75 38 07        		mov	scan_no,#07d
  317   0139   21 CF           		ajmp	out_scanner
  318                          	;----------------------------------------------------------------------
  319                          	
  320                          	
  321                          	
  322                          	;-(7)------------------------------------------------------------------
  323   013B                   	seven:
  324   013B   B4 07 0D        		cjne	a,#07d,eight		;
  325                          	;----------------------------------------
  326   013E   12 02 10        		call	disp_blank
  327                          	;----------------------------------------
  328   0141   A2 A7           		mov	c,krl4
  329   0143   12 01 D0        		call	k
  330                          	;----------------------------------------
  331   0146   75 38 08        		mov	scan_no,#08d
  332   0149   21 CF           		ajmp	out_scanner
  Wed Jun 14 2006 21:12                                                                                                  Page    7




  333                          	;----------------------------------------------------------------------
  334                          	
  335                          	
  336                          	
  337                          	;-(8)------------------------------------------------------------------
  338   014B                   	eight:
  339   014B   B4 08 15        		cjne	a,#08d,nine		;
  340                          	;----------------------------------------
  341                          	;key_output_line
  342   014E   D2 A0           		setb	sl1			;
  343   0150   D2 A1           		setb	sl2			;
  344   0152   C2 A2           		clr	sl3			;select display/row 3
  345   0154   D2 A3           		setb	sl4			;
  346                          	;----------------------------------------
  347   0156   12 02 2C        		call	adisp3
  348                          	;----------------------------------------
  349   0159   A2 A4           		mov	c,krl1
  350   015B   12 01 D0        		call	k
  351                          	;----------------------------------------
  352   015E   75 38 09        		mov	scan_no,#09d
  353   0161   21 CF           		ajmp	out_scanner
  354                          	;----------------------------------------------------------------------
  355                          	
  356                          	
  357                          	;-(9)------------------------------------------------------------------
  358   0163                   	nine:
  359   0163   B4 09 0A        		cjne	a,#09d,ten		;
  360                          	;----------------------------------------
  361                          	
  362                          	;----------------------------------------
  363   0166   A2 A5           		mov	c,krl2
  364   0168   12 01 D0        		call	k
  365                          	;----------------------------------------
  366   016B   75 38 0A        		mov	scan_no,#10d
  367   016E   21 CF           		ajmp	out_scanner
  368                          	;----------------------------------------------------------------------
  369                          	
  370                          	;-(10(a))--------------------------------------------------------------
  371   0170                   	ten:
  372   0170   B4 0A 0A        		cjne	a,#10d,eleven		;
  373                          	;----------------------------------------
  374                          	
  375                          	;----------------------------------------
  376   0173   A2 A6           		mov	c,krl3
  377   0175   12 01 D0        		call	k
  378                          	;----------------------------------------
  379   0178   75 38 0B        		mov	scan_no,#11d
  380   017B   21 CF           		ajmp	out_scanner
  381                          	;----------------------------------------------------------------------
  382                          	
  383                          	
  384                          	;-(11(b))--------------------------------------------------------------
  385   017D                   	eleven:
  386   017D   B4 0B 0D        		cjne	a,#11d,twelve		;
  387                          	;----------------------------------------
  388   0180   12 02 10        		call	disp_blank
  389                          	;----------------------------------------
  Wed Jun 14 2006 21:12                                                                                                  Page    8




  390   0183   A2 A7           		mov	c,krl4
  391   0185   12 01 D0        		call	k
  392                          	;----------------------------------------
  393   0188   75 38 0C        		mov	scan_no,#12d
  394   018B   21 CF           		ajmp	out_scanner
  395                          	;----------------------------------------------------------------------
  396                          	
  397                          	
  398                          	;-(12(c))--------------------------------------------------------------
  399   018D                   	twelve:
  400   018D   B4 0C 15        		cjne	a,#12d,thirteen		;
  401                          	;----------------------------------------
  402                          	;key_output_line
  403   0190   D2 A0           		setb	sl1			;
  404   0192   D2 A1           		setb	sl2			;
  405   0194   D2 A2           		setb	sl3			;
  406   0196   C2 A3           		clr	sl4			;select display/row 4
  407                          	;----------------------------------------
  408   0198   12 02 38        		call	adisp4
  409                          	;----------------------------------------
  410   019B   A2 A4           		mov	c,krl1
  411   019D   12 01 D0        		call	k
  412                          	;----------------------------------------
  413   01A0   75 38 0D        		mov	scan_no,#13d
  414   01A3   21 CF           		ajmp	out_scanner
  415                          	;----------------------------------------------------------------------
  416                          	
  417                          	;-(13(d))--------------------------------------------------------------
  418   01A5                   	thirteen:
  419   01A5   B4 0D 0A        		cjne	a,#13d,fourteen		;
  420                          	;----------------------------------------
  421                          	
  422                          	;----------------------------------------
  423   01A8   A2 A5           		mov	c,krl2
  424   01AA   12 01 D0        		call	k
  425                          	;----------------------------------------
  426   01AD   75 38 0E        		mov	scan_no,#14d
  427   01B0   21 CF           		ajmp	out_scanner
  428                          	;----------------------------------------------------------------------
  429                          	
  430                          	;-(14(e))--------------------------------------------------------------
  431   01B2                   	fourteen:
  432   01B2   B4 0E 0A        		cjne	a,#14d,fifteen		;
  433                          	;----------------------------------------
  434                          	
  435                          	;----------------------------------------
  436   01B5   A2 A6           		mov	c,krl3
  437   01B7   12 01 D0        		call	k
  438                          	;----------------------------------------
  439   01BA   75 38 0F        		mov	scan_no,#15d
  440   01BD   21 CF           		ajmp	out_scanner
  441                          	;----------------------------------------------------------------------
  442                          	
  443                          	;-(15(f))--------------------------------------------------------------
  444   01BF                   	fifteen:
  445   01BF   B4 0F 08        		cjne	a,#15d,dummy		;
  446                          	;----------------------------------------
  Wed Jun 14 2006 21:12                                                                                                  Page    9




  447   01C2   12 02 10        		call	disp_blank
  448                          	;----------------------------------------
  449   01C5   A2 A7           		mov	c,krl4
  450   01C7   12 01 D0        		call	k
  451                          	;----------------------------------------
  452   01CA   75 38 00        	dummy:	mov	scan_no,#00d
  453   01CD   21 CF           		ajmp	out_scanner
  454                          	;----------------------------------------------------------------------
  455                          	
  456                          	
  457                          	;----------------------------------------------------------------------
  458   01CF                   	out_scanner:
  459                          	;	
  460   01CF   22              		ret
  461                          	;----------------------------------------------------------------------
  462                          	
  463                          	;---------------------------------------------------
  464                          	;comes with c flag having the status of the corrosponding krl line.
  465   01D0                   	k:
  466   01D0   20 00 2A        		jb	key_ready,out_debounce
  467                          	;----------------------------------------
  468                          	;key detect....
  469   01D3   92 02           		mov	tb,c			;save carry bit
  470   01D5   E5 39           		mov	a,dcount
  471   01D7   B4 21 0C        		cjne	a,#33d,debounce
  472   01DA   A2 02           		mov	c,tb			;restore carry bit
  473                          	;key pressed for the first time...
  474   01DC   40 31           		jc	out_k
  475   01DE   15 39           		dec	dcount
  476   01E0   85 38 41        		mov	key_code,scan_no	;copy the scan_no in key_code
  477   01E3   02 02 0F        		jmp	out_k
  478                          	;----------------------------------------	
  479   01E6                   	debounce:
  480   01E6   D5 39 26        		djnz	dcount,out_k
  481                          	;debounce complete..now check for key press...
  482   01E9   A2 02           		mov	c,tb			;restore carry bit
  483   01EB   40 0A           		jc	spurious_key
  484   01ED   75 39 21        		mov	dcount,#33d
  485   01F0   D2 00           		setb	key_ready		;key still pressed (after debounce)
  486   01F2   D2 05           		setb	start_buzzer		;buzzer on
  487   01F4   02 02 0F        		jmp	out_k
  488   01F7                   	spurious_key:
  489   01F7   75 39 21        		mov	dcount,#33d
  490   01FA   02 02 0F        		jmp	out_k
  491   01FD                   	out_debounce:
  492                          	;----------------------------------------
  493                          	;check for key release...
  494   01FD   40 06           		jc	l1_k
  495   01FF   75 40 20        		mov	krcount,#32d
  496   0202   02 02 0F        		jmp	out_k
  497   0205                   	l1_k:
  498   0205   D5 40 07        		djnz	krcount,out_k
  499   0208   D2 01           		setb	nkp			;key release
  500   020A   C2 05           		clr	start_buzzer		;buzzer off
  501   020C   75 40 20        		mov	krcount,#32d
  502                          	;	jmp	out_k
  503                          	;----------------------------------------
  Wed Jun 14 2006 21:12                                                                                                  Page   10




  504   020F                   	out_k:
  505   020F   22              		ret		
  506                          	;---------------------------------------------------
  507                          	
  508                          	
  509                          	
  510                          	;---------------------------------------------------
  511                          	;Subroutines here onwards3...
  512                          	;disp_blank
  513                          	;adisp1,2,3,4
  514                          	;test_display
  515                          	;wait_1sec
  516                          	;wait_20ms
  517                          	;inc_d
  518                          	;key_release
  519                          	;get_key
  520                          	;keyprocess
  521                          	;disp_sw
  522                          	;---------------------------------------------------
  523   0210                   	disp_blank:
  524   0210   75 80 00        		mov 	p0,#00h
  525   0213   22              		ret
  526                          	;---------------------------------------------------
  527                          	
  528                          	
  529                          	;---------------------------------------------------
  530   0214                   	adisp1:
  531   0214   90 02 44        		mov 	dptr,#adisp_lut
  532   0217   E5 30           		mov 	a,ds1
  533   0219   C3              		clr	c
  534   021A   94 30           		subb	a,#"0"
  535   021C   93              		movc 	a,@a+dptr
  536   021D   F5 80           		mov 	p0,a
  537   021F   22              		ret
  538                          	
  539                          	;----------------------------------------
  540   0220                   	adisp2:
  541   0220   90 02 44        		mov 	dptr,#adisp_lut
  542   0223   E5 31           		mov 	a,ds2
  543   0225   C3              		clr	c
  544   0226   94 30           		subb	a,#"0"
  545   0228   93              		movc 	a,@a+dptr
  546   0229   F5 80           		mov 	p0,a
  547   022B   22              		ret
  548                          	
  549                          	;----------------------------------------
  550   022C                   	adisp3:
  551   022C   90 02 44        		mov 	dptr,#adisp_lut
  552   022F   E5 32           		mov 	a,ds3
  553   0231   C3              		clr	c
  554   0232   94 30           		subb	a,#"0"
  555   0234   93              		movc 	a,@a+dptr
  556   0235   F5 80           		mov 	p0,a
  557   0237   22              		ret
  558                          	
  559                          	;----------------------------------------
  560   0238                   	adisp4:
  Wed Jun 14 2006 21:12                                                                                                  Page   11




  561   0238   90 02 44        		mov 	dptr,#adisp_lut
  562   023B   E5 33           		mov 	a,ds4
  563   023D   C3              		clr	c
  564   023E   94 30           		subb	a,#"0"
  565   0240   93              		movc 	a,@a+dptr
  566   0241   F5 80           		mov 	p0,a
  567   0243   22              		ret
  568                          	;----------------------------------------
  569                          	
  570                          	;----------------------------------------
  571                          	
  572   0244                   	adisp_lut:
  573                          	;		-abcdefgd-		
  574   0244   FC              		db	 11111100b	;0
  575   0245   60              		db	 01100000b	;1
  576   0246   DA              		db	 11011010b	;2
  577   0247   F2              		db	 11110010b	;3
  578   0248   66              		db	 01100110b	;4
  579   0249   B6              		db	 10110110b	;5
  580   024A   BE              		db	 10111110b	;6
  581   024B   E0              		db	 11100000b	;7
  582   024C   FE              		db	 11111110b	;8
  583   024D   E6              		db	 11100110b	;9
  584                          	;
  585   024E   FF              		db	 11111111b	;3a
  586   024F   FF              		db	 11111111b	;3b
  587   0250   FF              		db	 11111111b	;3c
  588   0251   FF              		db	 11111111b	;3d
  589   0252   FF              		db	 11111111b	;3e
  590   0253   FF              		db	 11111111b	;3f
  591   0254   FF              		db	 11111111b	;40
  592                          	;
  593   0255   EE              		db	 11101110b	;A
  594   0256   3E              		db	 00111110b	;B
  595   0257   9C              		db	 10011100b	;C
  596   0258   7A              		db	 01111010b	;D
  597   0259   9E              		db	 10011110b	;E
  598   025A   8E              		db	 10001110b	;F
  599   025B   BC              		db	 10111100b	;G
  600   025C   6E              		db	 01101110b	;H
  601   025D   0C              		db	 00001100b	;I
  602   025E   70              		db	 01110000b	;J
  603   025F   0E              		db	 00001110b	;K
  604   0260   1C              		db	 00011100b	;L
  605   0261   AA              		db	 10101010b	;M
  606   0262   2A              		db	 00101010b	;N
  607   0263   3A              		db	 00111010b	;O
  608   0264   CE              		db	 11001110b	;P
  609   0265   D6              		db	 11010110b	;Q
  610   0266   0A              		db	 00001010b	;R
  611   0267   B6              		db	 10110110b	;S
  612   0268   1E              		db	 00011110b	;T
  613   0269   7C              		db	 01111100b	;U
  614   026A   38              		db	 00111000b	;V
  615   026B   B8              		db	 10111000b	;W
  616   026C   62              		db	 01100010b	;X
  617   026D   66              		db	 01100110b	;Y
  Wed Jun 14 2006 21:12                                                                                                  Page   12




  618   026E   92              		db	 10010010b	;Z
  619   026F   00              		db	 00000000b	;Z+1 for space
  620   0270   FF              		db	 11111111b	;Z+2 for all segment glow
  621                          	;---------------------------------------------------
  622                          	
  623                          	;---------------------------------------------------
  624   0271                   	test_display:
  625   0271   75 30 5C        		mov	ds1,#"Z"+2	;glow all segments
  626   0274   75 31 5C        		mov	ds2,#"Z"+2
  627   0277   75 32 5C        		mov	ds3,#"Z"+2
  628   027A   75 33 5C        		mov	ds4,#"Z"+2
  629                          	;
  630   027D   12 02 90        		call	wait_1sec
  631                          	;
  632   0280   75 30 5B        		mov	ds1,#"Z"+1	;put off all segments
  633   0283   75 31 5B        		mov	ds2,#"Z"+1
  634   0286   75 32 5B        		mov	ds3,#"Z"+1
  635   0289   75 33 5B        		mov	ds4,#"Z"+1
  636                          	;
  637   028C   12 02 90        		call	wait_1sec
  638                          	;
  639   028F   22              		ret
  640                          	;---------------------------------------------------
  641                          	
  642                          	;--------------------------------------------------- 
  643   0290                   	wait_1sec:
  644   0290   75 36 07        		mov	dcount_3,#07d
  645   0293   75 35 FF        	l2:	mov 	dcount_2,#0ffh
  646   0296   75 34 FF        	l1:	mov 	dcount_1,#0ffh
  647   0299   D5 34 FD        		djnz 	dcount_1,$
  648   029C   D5 35 F7        		djnz 	dcount_2,l1
  649   029F   D5 36 F1        		djnz 	dcount_3,l2
  650   02A2   22              		ret
  651                          	;---------------------------------------------------
  652                          	
  653                          	;---------------------------------------------------
  654   02A3                   	wait_20ms:
  655   02A3   75 35 55        		mov	dcount_2,#55h
  656   02A6   75 34 FF        		mov	dcount_1,#0ffh		;$-3-3
  657   02A9   D5 34 FD        		djnz	dcount_1,$		;$-3
  658   02AC   D5 35 F7        		djnz	dcount_2,$-3-3
  659   02AF   22              		ret
  660                          	;---------------------------------------------------
  661                          	
  662                          	;---------------------------------------------------
  663                          	;Increments value of ds4 ds3 ds2 ds1 considering as a singal
  664                          	;four digit no from 0000 to 9999
  665   02B0                   	inc_d:
  666   02B0   30 03 3A        		jnb	start_sw,out_id 
  667   02B3   05 30           		inc 	ds1
  668   02B5   E5 30           		mov 	a,ds1
  669   02B7   B4 3A 00        		cjne 	a,#"9"+1,$+3
  670   02BA   50 01           		jnc 	l1_id 
  671   02BC   22              		ret
  672                          	
  673                          	;----------------------------------------
  674   02BD   75 30 30        	l1_id:	mov 	ds1,#"0"
  Wed Jun 14 2006 21:12                                                                                                  Page   13




  675   02C0   05 31           		inc 	ds2
  676   02C2   E5 31           		mov 	a,ds2
  677   02C4   B4 3A 00        		cjne 	a,#"9"+1,$+3
  678   02C7   50 01           		jnc 	l2_id
  679   02C9   22              		ret
  680                          	
  681                          	;----------------------------------------
  682   02CA   75 31 30        	l2_id:	mov 	ds2,#"0"
  683   02CD   05 32           		inc 	ds3
  684   02CF   E5 32           		mov 	a,ds3
  685   02D1   B4 3A 00        		cjne 	a,#"9"+1,$+3 
  686   02D4   50 01           		jnc 	l3_id
  687   02D6   22              		ret
  688                          	
  689                          	;----------------------------------------
  690   02D7   75 32 30        	l3_id:	mov 	ds3,#"0"
  691   02DA   05 33           		inc 	ds4 
  692   02DC   E5 33           		mov 	a,ds4
  693   02DE   B4 3A 0C        		cjne 	a,#"9"+1,out_id
  694                          	;
  695   02E1   75 30 30        		mov	ds1,#"0"
  696   02E4   75 31 30        		mov	ds2,#"0"
  697   02E7   75 32 30        		mov	ds3,#"0"
  698   02EA   75 33 30        		mov	ds4,#"0"
  699                          	
  700                          	;----------------------------------------
  701   02ED                   	out_id:
  702   02ED   22              		ret
  703                          	;---------------------------------------------------
  704                          	
  705                          	;---------------------------------------------------
  706   02EE                   	key_release:
  707   02EE   30 01 FD        		jnb	nkp,$	;wait for no key press flag
  708   02F1   C2 00           		clr	key_ready
  709   02F3   C2 01           		clr	nkp
  710   02F5   22              		ret
  711                          	;---------------------------------------------------
  712                          	
  713                          	;---------------------------------------------------
  714                          	;gets ascii code for key pressed in "a" and key_code.
  715   02F6                   	get_key:
  716   02F6   30 00 FD        		jnb	key_ready,$
  717   02F9   E5 41           		mov	a,key_code
  718   02FB   90 03 02        		mov	dptr,#ascii_key
  719   02FE   93              		movc	a,@a+dptr
  720   02FF   F5 41           		mov	key_code,a
  721   0301   22              		ret
  722   0302   30 31 32 33 34  	ascii_key:	db	"0123456789ABCDEF"
        0307   35 36 37 38 39 
        030C   41 42 43 44 45 
        0311   46 
  723                          	;---------------------------------------------------
  724                          	
  725                          	;---------------------------------------------------
  726   0312                   	keyprocess:
  727   0312   E5 41           		mov	a,key_code
  728                          	;
  Wed Jun 14 2006 21:12                                                                                                  Page   14




  729   0314   B4 41 06        		cjne	a,#"A",chk_b
  730                          	;---------------------------
  731   0317   12 03 32        		call	process_a
  732   031A   02 03 2F        		jmp	out_kp
  733                          	;---------------------------
  734   031D   B4 42 06        	chk_b:	cjne	a,#"B",chk_c
  735                          	;---------------------------
  736   0320   12 03 35        		call	process_b
  737   0323   02 03 2F        		jmp	out_kp
  738                          	;---------------------------
  739   0326   B4 43 06        	chk_c:	cjne	a,#"C",out_kp
  740                          	;---------------------------
  741   0329   12 03 38        		call	process_c
  742   032C   02 03 2F        		jmp	out_kp
  743                          	;---------------------------
  744   032F                   	out_kp:
  745   032F   51 EE           		call	key_release
  746   0331   22              		ret
  747                          	;---------------------------------------------------
  748                          	
  749                          	
  750                          	;----------------------------------------
  751   0332                   	process_a:
  752   0332   D2 03           		setb	start_sw
  753   0334   22              		ret
  754                          	;----------------------------------------
  755                          	
  756                          	;----------------------------------------
  757   0335                   	process_b:
  758   0335   C2 03           		clr	start_sw
  759   0337   22              		ret
  760                          	;----------------------------------------
  761                          	
  762                          	;----------------------------------------
  763   0338                   	process_c:
  764   0338   C2 03           		clr	start_sw
  765                          	;
  766   033A   75 30 30        		mov	ds1,#"0"		;reset count to 0000
  767   033D   75 31 30        		mov	ds2,#"0"
  768   0340   75 32 30        		mov	ds3,#"0"
  769   0343   75 33 30        		mov	ds4,#"0"
  770                          	;
  771   0346   22              		ret
  772                          	;---------------------------------------------------
  773                          	
  774                          	;---------------------------------------------------
  775   0347                   	disp_sw:
  776   0347   75 30 5B        		mov	ds1,#"Z"+1
  777   034A   75 31 5B        		mov	ds2,#"Z"+1
  778   034D   75 32 57        		mov	ds3,#"W"
  779   0350   75 33 53        		mov	ds4,#"S"
  780   0353   22              		ret
  781                          	;---------------------------------------------------
  782   0354                   	buzzer:
  783   0354   30 05 02        		jnb	start_buzzer,out_b
  784                          	
  785   0357   B2 95           		cpl	p1.5
  Wed Jun 14 2006 21:12                                                                                                  Page   15




  786   0359                   	out_b:
  787   0359   22              		ret
  788                          	;---------------------------------------------------
  789   035A                   		end
  Wed Jun 14 2006 21:12                                                                                                  Page   16


Defined            Symbol Name             Value                References

  530    adisp1                             0214          217
  540    adisp2                             0220          281
  550    adisp3                             022C          347
  560    adisp4                             0238          408
  572    adisp_lut                          0244          531    541    551    561
  722    ascii_key                          0302          718
  Pre    BSECT                              0000      
  782    buzzer                             0354          167
  734    chk_b                              031D          729
  739    chk_c                              0326          734
   22    cnt_1sh                         =  0043          151    189    191
   21    cnt_1sl                         =  0042          150    188    192    196
  Pre    CODE                               002B           48     51     54     57     60     66     70
   16    count                           =  0037      
  Pre    DATA                               0000      
   18    dcount                          =  0039          128    470    475    480    484    489
   12    dcount_1                        =  0034          646    647    656    657
   13    dcount_2                        =  0035          645    648    655    658
   14    dcount_3                        =  0036          644    649
  479    debounce                           01E6          471
  186    delay_1sec                         00AF          165
  523    disp_blank                         0210          260    326    388    447
  775    disp_sw                            0347           90
    7    ds1                             =  0030          115    532    625    632    667    668    674    695    766    776
    8    ds2                             =  0031          116    542    626    633    675    676    682    696    767    777
    9    ds3                             =  0032          117    552    627    634    683    684    690    697    768    778
   10    ds4                             =  0033          118    562    628    635    691    692    698    769    779
  452    dummy                              01CA          445
  338    eight                              014B          324
  385    eleven                             017D          372
  444    fifteen                            01BF          432
  293    five                               0121          273
  272    four                               0109          258
  431    fourteen                           01B2          419
  715    get_key                            02F6           91
  665    inc_d                              02B0          172
  100    init                               0042           84
  149    init_delay_1sec                    0082          108
  114    init_display                       004F          104
  122    init_keypad                        005C          106
  140    init_timer0                        0074          102    163
  157    isr_t0                             008B           55
  465    k                                  01D0          220    234    248    263    284    299    314    329    350    364    377
                                                          391    411    424    437    450
  726    keyprocess                         0312           92
   20    key_code                        =  0041          476    717    720    727
   40    key_ready                       =  0000          130    466    485    708    716
  706    key_release                        02EE          745
   19    krcount                         =  0040          129    495    498    501
   35    krl1                            =  00A4          123    219    283    349    410
   36    krl2                            =  00A5          124    233    298    363    423
   37    krl3                            =  00A6          125    247    313    376    436
   38    krl4                            =  00A7          126    262    328    390    449
  646    l1                                 0296          648
  674    l1_id                              02BD          670
  497    l1_k                               0205          494
  645    l2                                 0293          649
  Wed Jun 14 2006 21:12                                                                                                  Page   17


Defined            Symbol Name             Value                References

  682    l2_id                              02CA          678
  690    l3_id                              02D7          686
   91    loop                               003A           93
   82    main                               002C           49
  358    nine                               0163          339
   41    nkp                             =  0001          131    499    707    709
  228    one                                00DF          209
  786    out_b                              0359          783
  491    out_debounce                       01FD          466
  197    out_ds1sec                         00C4          187    188
  701    out_id                             02ED          666    693
  175    out_isr                            00A6          171
  504    out_k                              020F          474    477    480    487    490    496    498
  744    out_kp                             032F          732    737    739    742
  458    out_scanner                        01CF          223    237    251    266    287    302    317    332    353    367    380
                                                          394    414    427    440    453
  751    process_a                          0332          731
  757    process_b                          0335          736
  763    process_c                          0338          741
  195    reinit_1sl                         00C1          189
  Pre    RSECT                              0000      
   45    s1_over                         =  0004          152    171    173    187    193
  201    scanner                            00C5          169
   17    scan_no                         =  0038          127    203    222    236    250    265    286    301    316    331    352
                                                          366    379    393    413    426    439    452    476
  323    seven                              013B          309
  308    six                                012E          294
   30    sl1                             =  00A0          212    276    342    403
   31    sl2                             =  00A1          213    277    343    404
   32    sl3                             =  00A2          214    278    344    405
   33    sl4                             =  00A3          215    279    345    406
  488    spurious_key                       01F7          483
   46    start_buzzer                    =  0005          132    486    500    783
   44    start_sw                        =  0003          666    752    758    764
   42    tb                              =  0002          469    472    482
  371    ten                                0170          359
  624    test_display                       0271           88
  418    thirteen                           01A5          400
  257    three                              00F9          243
   25    top_of_stack                    =  0060           83
  399    twelve                             018D          386
  242    two                                00EC          229
  643    wait_1sec                          0290          630    637
  654    wait_20ms                          02A3      
  208    zero                               00C7      




           Lines Assembled :  789             Assembly Errors :  0


