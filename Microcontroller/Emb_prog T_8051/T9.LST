  Wed Jun 14 2006 20:47                                                                                                  Page    1







               2500 A.D. 8051 Macro Assembler  -  Version 4.03c
               ------------------------------------------------

                       Input  Filename : t9.asm
                       Output Filename : t9.obj


    1                          	;t9.asm
    2                          	;Keypad scanning in interrupt 
    3                          	;display value of key from 0 to f on display1
    4                          	;----------------------------------------------------------------------
    5   0000                   		CHIP 8052
    6                          		.list on
    7                          	;----------------------------------------------------------------------
    8                          	;Define byte variables...
    9          0030            	ds1:		EQU	30h	;location for displaying value on display1
   10          0031            	ds2:		EQU	31h	;location for displaying value on display2
   11          0032            	ds3:		EQU	32h	;location for displaying value on display3
   12          0033            	ds4:		EQU	33h	;location for displaying value on display4
   13                          	;
   14          0034            	dcount_1:	EQU	34h	;variable for generating delay
   15          0035            	dcount_2:	EQU	35h	;variable for generating delay
   16          0036            	dcount_3:	EQU	36h	;variable for generating delay
   17                          	;
   18          0037            	count:		EQU	37h	;
   19          0038            	scan_no:	EQU	38h	;scan number for counting interrupts and key identification
   20          0039            	dcount:		EQU	39h	;debounce count
   21          0040            	krcount:	EQU	40h	;key release count
   22          0041            	key_code:	EQU	41h	;key code
   23                          	;----------------------------------------------------------------------
   24                          	;define imidiate values..
   25          0060            	top_of_stack:	EQU	60h
   26                          	;---------------------------------------------------
   27                          	
   28                          	;---------------------------------------------------
   29                          	;define bit variables here...
   30          00A0            	sl1:		REG	P2.0		;display1/row1
   31          00A1            	sl2:		REG	P2.1		;display2/row2
   32          00A2            	sl3:		REG	P2.2		;display3/row3
   33          00A3            	sl4:		REG	P2.3		;display4/row4
   34                          	;
   35          00A4            	krl1:		REG	p2.4		;key return line 1
   36          00A5            	krl2:		REG	p2.5		;key return line 2
   37          00A6            	krl3:		REG	p2.6		;key return line 3
   38          00A7            	krl4:		REG	p2.7		;key return line 4
   39                          	;----------------------------------------------------
   40          0000            	key_ready:	REG	00h		;this flag is set when key is detected (after debounce).
   41          0001            	nkp:		REG	01h		;this flag is set when no key is pressed.
   42          0002            	tb:		REG	02h		;temp bit location
   43          0003            	start_buzzer:	REG	03h		;buzzer bit
   44                          	;----------------------------------------------------
   45                          	
   46                          	;----------------------------------------------------------------------
   47   0000                   		org 	0000h
  Wed Jun 14 2006 20:47                                                                                                  Page    2




   48   0000   02 00 2C        		jmp	main
   49                          	;----------------------------------------------------------------------
   50   0003                   		org     0003h
   51   0003   32              		reti			;ljmp	isr_i0
   52                          	;
   53   000B                   		org     000bh
   54   000B   02 00 A0        		ljmp	isr_t0		;timer0 interrupt
   55                          	;
   56   0013                   		org     0013h
   57   0013   32              		reti
   58                          					;ljmp    isr_i1			
   59                          	;
   60   001B                   		org     001bh
   61   001B   32              		reti
   62                          		;ljmp	isr_t1		;timer1 interrupt
   63                          					;(isr_t1)baud rate for Usart
   64                          					;(...hence no Interrupt)
   65                          	;
   66   0023                   		org     0023h
   67   0023   32              	        reti
   68                          		;ljmp    isr_receive         ;Interrupt enabled only for receive.
   69                          	;
   70   002B                   		org     002bh
   71   002B   32              	        reti
   72                          		;ljmp    isr_t2
   73                          	;
   74                          	;----------------------------------------------------------------------
   75                          	
   76                          	;----------------------------------------------------------------------
   77   002C                   	main:
   78   002C   75 81 60        		mov	sp,#top_of_stack
   79   002F   12 00 63        		call	init		;init timer,display,etc.
   80                          	;
   81   0032   D2 AF           		setb	ea		;enable all interupts
   82                          	;
   83   0034   12 02 4F        		call	test_display
   84                          	;
   85                          	;initilise the counter...
   86                          	
   87   0037   75 30 3B        		mov	ds1,#"9"+2
   88   003A   75 31 3A        		mov	ds2,#"9"+1
   89   003D   75 32 3A        		mov	ds3,#"9"+1
   90   0040   75 33 3A        		mov	ds4,#"9"+1
   91                          	;---------------------------------------------------
   92   0043                   	l1_main:
   93                          	;---------------------------------------------------
   94   0043   30 00 FD        		jnb	key_ready,$
   95   0046   E5 41           		mov	a,key_code	;keycode has value 00..0f
   96                          	;-------------------------
   97   0048   90 00 53        		mov	dptr,#ascii_tab
   98   004B   93              		movc	a,@a+dptr
   99   004C   F5 30           		mov	ds1,a
  100   004E   12 02 C9        		call	key_release
  101   0051   01 43           		jmp	l1_main
  102                          	
  103   0053   30 31 32 33 34  	ascii_tab:	db	"0123456789ABCDEF"	
        0058   35 36 37 38 39 
  Wed Jun 14 2006 20:47                                                                                                  Page    3




        005D   41 42 43 44 45 
        0062   46 
  104                          	;-------------------------
  105   0063                   		
  106                          	;**********************************************************
  107                          	
  108                          	
  109                          	;----------------------------------------------------------
  110                          	;initialising routines done here...
  111                          	;----------------------------------------------------------------------
  112   0063                   	init:
  113                          	;--------------------------
  114   0063   12 00 6D        		call	init_display
  115                          	;--------------------------
  116   0066   12 00 7A        		call	init_keypad
  117                          	;--------------------------
  118   0069   12 00 92        		call	init_timer0
  119                          	;--------------------------
  120   006C   22              		ret
  121                          	;---------------------------------------------------
  122                          	;---------------------------------------------------
  123   006D                   	init_display:
  124   006D   75 30 3B        		mov	ds1,#"9"+2	;glow all segments
  125   0070   75 31 3B        		mov	ds2,#"9"+2
  126   0073   75 32 3B        		mov	ds3,#"9"+2
  127   0076   75 33 3B        		mov	ds4,#"9"+2
  128   0079   22              		ret
  129                          	;---------------------------------------------------
  130                          	;---------------------------------------------------
  131   007A                   	init_keypad:
  132   007A   D2 A4           		setb	krl1
  133   007C   D2 A5           		setb	krl2
  134   007E   D2 A6           		setb	krl3
  135   0080   D2 A7           		setb	krl4
  136   0082   75 38 00        		mov	scan_no,#00d
  137   0085   75 39 21        		mov	dcount,#33d
  138   0088   75 40 20        		mov	krcount,#32d
  139   008B   C2 00           		clr	key_ready
  140   008D   C2 01           		clr	nkp
  141   008F   C2 03           		clr	start_buzzer
  142   0091   22              		ret
  143                          	;---------------------------------------------------
  144                          	;---------------------------------------------------
  145                          		;(89h)
  146                          		;TMOD-->GATE, C/T, M1,	M0, GATE, C/T, M1, M0, T/C (timer1,timer0)
  147                          		;init timer 0  for 1msec
  148   0092                   	init_timer0:
  149   0092   43 89 01        		orl	tmod,#01h		;t0 in 16 bit timer mode.
  150   0095   75 8A 66        		mov	tl0,#66h		;Init timer0 with count for 1msec.
  151   0098   75 8C FC        		mov	th0,#0fch		;count=0fc66h for 1msec.
  152   009B   D2 8C           		setb	tr0			;start timer 0.
  153   009D   D2 A9           	        setb	et0			;enable timer 0 Interrupt.
  154   009F   22              		ret 
  155                          	;----------------------------------------------------------------------
  156                          	
  157                          	
  158                          	;----------------------------------------------------------------------
  Wed Jun 14 2006 20:47                                                                                                  Page    4




  159   00A0                   	isr_t0:
  160   00A0   C0 E0           		push	a
  161   00A2   C0 D0           		push	psw
  162   00A4   C0 83           		push	dph
  163   00A6   C0 82           		push	dpl
  164                          	;
  165   00A8   11 92           		call	init_timer0
  166   00AA   12 02 D1        		call	buzzer
  167   00AD   12 00 B9        		call	scanner			;spoils a,psw,dptr
  168   00B0                   	out_isr:
  169   00B0   D0 82           		pop	dpl
  170   00B2   D0 83           		pop	dph
  171   00B4   D0 D0           		pop	psw
  172   00B6   D0 E0           		pop	a
  173   00B8   32              		reti
  174                          	;----------------------------------------------------------------------
  175                          	
  176                          	;----------------------------------------------------------------------
  177   00B9                   	scanner:	
  178                          	;----------------------------------------------------------------------
  179   00B9   E5 38           		mov	a,scan_no
  180                          	;----------------------------------------------------------------------
  181                          	
  182                          	
  183                          	;-(0)------------------------------------------------------------------
  184   00BB                   	zero:
  185   00BB   B4 00 15        		cjne	a,#00d,one		;
  186                          	;----------------------------------------
  187                          	;----------------------------------------
  188                          	;key_output_line
  189   00BE   C2 A0           		clr	sl1			;select display/row 1
  190   00C0   D2 A1           		setb	sl2			;
  191   00C2   D2 A2           		setb	sl3			;
  192   00C4   D2 A3           		setb	sl4			;
  193                          	;----------------------------------------
  194   00C6   12 02 08        		call	adisp1
  195                          	;----------------------------------------
  196   00C9   A2 A4           		mov	c,krl1
  197   00CB   12 01 C4        		call	k
  198                          	;----------------------------------------
  199   00CE   75 38 01        		mov	scan_no,#01d
  200   00D1   21 C3           		ajmp	out_scanner
  201                          	;----------------------------------------------------------------------
  202                          	
  203                          	
  204                          	;-(1)------------------------------------------------------------------
  205   00D3                   	one:
  206   00D3   B4 01 0A        		cjne	a,#01d,two		;
  207                          	;----------------------------------------
  208                          	
  209                          	;----------------------------------------
  210   00D6   A2 A5           		mov	c,krl2
  211   00D8   12 01 C4        		call	k
  212                          	;----------------------------------------
  213   00DB   75 38 02        		mov	scan_no,#02d	
  214   00DE   21 C3           		ajmp	out_scanner
  215                          	;----------------------------------------------------------------------
  Wed Jun 14 2006 20:47                                                                                                  Page    5




  216                          	
  217                          	
  218                          	;-(2)------------------------------------------------------------------
  219   00E0                   	two:
  220   00E0   B4 02 0A        		cjne	a,#02d,three		;
  221                          	;----------------------------------------
  222                          	
  223                          	;----------------------------------------
  224   00E3   A2 A6           		mov	c,krl3
  225   00E5   12 01 C4        		call	k
  226                          	;----------------------------------------
  227   00E8   75 38 03        		mov	scan_no,#03d
  228   00EB   21 C3           		ajmp	out_scanner
  229                          	;----------------------------------------------------------------------
  230                          	
  231                          	
  232                          	
  233                          	;-(3)------------------------------------------------------------------
  234   00ED                   	three:
  235   00ED   B4 03 0D        		cjne	a,#03d,four		;
  236                          	;----------------------------------------
  237   00F0   12 02 04        		call	disp_blank
  238                          	;----------------------------------------
  239   00F3   A2 A7           		mov	c,krl4
  240   00F5   12 01 C4        		call	k
  241                          	;----------------------------------------
  242   00F8   75 38 04        		mov	scan_no,#04d
  243   00FB   21 C3           		ajmp	out_scanner
  244                          	;----------------------------------------------------------------------
  245                          	
  246                          	
  247                          	
  248                          	;-(4)------------------------------------------------------------------
  249   00FD                   	four:
  250   00FD   B4 04 15        		cjne	a,#04d,five		;
  251                          	;----------------------------------------
  252                          	;key_output_line
  253   0100   D2 A0           		setb	sl1			;
  254   0102   C2 A1           		clr	sl2			;select display/row 2
  255   0104   D2 A2           		setb	sl3			;
  256   0106   D2 A3           		setb	sl4			;
  257                          	;----------------------------------------
  258   0108   12 02 14        		call	adisp2
  259                          	;----------------------------------------
  260   010B   A2 A4           		mov	c,krl1
  261   010D   12 01 C4        		call	k
  262                          	;----------------------------------------
  263   0110   75 38 05        		mov	scan_no,#05d
  264   0113   21 C3           		ajmp	out_scanner
  265                          	;----------------------------------------------------------------------
  266                          	
  267                          	
  268                          	
  269                          	;-(5)------------------------------------------------------------------
  270   0115                   	five:
  271   0115   B4 05 0A        		cjne	a,#05d,six		;
  272                          	;----------------------------------------
  Wed Jun 14 2006 20:47                                                                                                  Page    6




  273                          	
  274                          	;----------------------------------------
  275   0118   A2 A5           		mov	c,krl2
  276   011A   12 01 C4        		call	k
  277                          	;----------------------------------------
  278   011D   75 38 06        		mov	scan_no,#06d
  279   0120   21 C3           		ajmp	out_scanner
  280                          	;----------------------------------------------------------------------
  281                          	
  282                          	
  283                          	
  284                          	;-(6)------------------------------------------------------------------
  285   0122                   	six:
  286   0122   B4 06 0A        		cjne	a,#06d,seven		;
  287                          	;----------------------------------------
  288                          	
  289                          	;----------------------------------------
  290   0125   A2 A6           		mov	c,krl3
  291   0127   12 01 C4        		call	k
  292                          	;----------------------------------------
  293   012A   75 38 07        		mov	scan_no,#07d
  294   012D   21 C3           		ajmp	out_scanner
  295                          	;----------------------------------------------------------------------
  296                          	
  297                          	
  298                          	
  299                          	;-(7)------------------------------------------------------------------
  300   012F                   	seven:
  301   012F   B4 07 0D        		cjne	a,#07d,eight		;
  302                          	;----------------------------------------
  303   0132   12 02 04        		call	disp_blank
  304                          	;----------------------------------------
  305   0135   A2 A7           		mov	c,krl4
  306   0137   12 01 C4        		call	k
  307                          	;----------------------------------------
  308   013A   75 38 08        		mov	scan_no,#08d
  309   013D   21 C3           		ajmp	out_scanner
  310                          	;----------------------------------------------------------------------
  311                          	
  312                          	
  313                          	
  314                          	;-(8)------------------------------------------------------------------
  315   013F                   	eight:
  316   013F   B4 08 15        		cjne	a,#08d,nine		;
  317                          	;----------------------------------------
  318                          	;key_output_line
  319   0142   D2 A0           		setb	sl1			;
  320   0144   D2 A1           		setb	sl2			;
  321   0146   C2 A2           		clr	sl3			;select display/row 3
  322   0148   D2 A3           		setb	sl4			;
  323                          	;----------------------------------------
  324   014A   12 02 20        		call	adisp3
  325                          	;----------------------------------------
  326   014D   A2 A4           		mov	c,krl1
  327   014F   12 01 C4        		call	k
  328                          	;----------------------------------------
  329   0152   75 38 09        		mov	scan_no,#09d
  Wed Jun 14 2006 20:47                                                                                                  Page    7




  330   0155   21 C3           		ajmp	out_scanner
  331                          	;----------------------------------------------------------------------
  332                          	
  333                          	
  334                          	;-(9)------------------------------------------------------------------
  335   0157                   	nine:
  336   0157   B4 09 0A        		cjne	a,#09d,ten		;
  337                          	;----------------------------------------
  338                          	
  339                          	;----------------------------------------
  340   015A   A2 A5           		mov	c,krl2
  341   015C   12 01 C4        		call	k
  342                          	;----------------------------------------
  343   015F   75 38 0A        		mov	scan_no,#10d
  344   0162   21 C3           		ajmp	out_scanner
  345                          	;----------------------------------------------------------------------
  346                          	
  347                          	;-(10(a))--------------------------------------------------------------
  348   0164                   	ten:
  349   0164   B4 0A 0A        		cjne	a,#10d,eleven		;
  350                          	;----------------------------------------
  351                          	
  352                          	;----------------------------------------
  353   0167   A2 A6           		mov	c,krl3
  354   0169   12 01 C4        		call	k
  355                          	;----------------------------------------
  356   016C   75 38 0B        		mov	scan_no,#11d
  357   016F   21 C3           		ajmp	out_scanner
  358                          	;----------------------------------------------------------------------
  359                          	
  360                          	
  361                          	;-(11(b))--------------------------------------------------------------
  362   0171                   	eleven:
  363   0171   B4 0B 0D        		cjne	a,#11d,twelve		;
  364                          	;----------------------------------------
  365   0174   12 02 04        		call	disp_blank
  366                          	;----------------------------------------
  367   0177   A2 A7           		mov	c,krl4
  368   0179   12 01 C4        		call	k
  369                          	;----------------------------------------
  370   017C   75 38 0C        		mov	scan_no,#12d
  371   017F   21 C3           		ajmp	out_scanner
  372                          	;----------------------------------------------------------------------
  373                          	
  374                          	
  375                          	;-(12(c))--------------------------------------------------------------
  376   0181                   	twelve:
  377   0181   B4 0C 15        		cjne	a,#12d,thirteen		;
  378                          	;----------------------------------------
  379                          	;key_output_line
  380   0184   D2 A0           		setb	sl1			;
  381   0186   D2 A1           		setb	sl2			;
  382   0188   D2 A2           		setb	sl3			;
  383   018A   C2 A3           		clr	sl4			;select display/row 4
  384                          	;----------------------------------------
  385   018C   12 02 2C        		call	adisp4
  386                          	;----------------------------------------
  Wed Jun 14 2006 20:47                                                                                                  Page    8




  387   018F   A2 A4           		mov	c,krl1
  388   0191   12 01 C4        		call	k
  389                          	;----------------------------------------
  390   0194   75 38 0D        		mov	scan_no,#13d
  391   0197   21 C3           		ajmp	out_scanner
  392                          	;----------------------------------------------------------------------
  393                          	
  394                          	;-(13(d))--------------------------------------------------------------
  395   0199                   	thirteen:
  396   0199   B4 0D 0A        		cjne	a,#13d,fourteen		;
  397                          	;----------------------------------------
  398                          	
  399                          	;----------------------------------------
  400   019C   A2 A5           		mov	c,krl2
  401   019E   12 01 C4        		call	k
  402                          	;----------------------------------------
  403   01A1   75 38 0E        		mov	scan_no,#14d
  404   01A4   21 C3           		ajmp	out_scanner
  405                          	;----------------------------------------------------------------------
  406                          	
  407                          	;-(14(e))--------------------------------------------------------------
  408   01A6                   	fourteen:
  409   01A6   B4 0E 0A        		cjne	a,#14d,fifteen		;
  410                          	;----------------------------------------
  411                          	
  412                          	;----------------------------------------
  413   01A9   A2 A6           		mov	c,krl3
  414   01AB   12 01 C4        		call	k
  415                          	;----------------------------------------
  416   01AE   75 38 0F        		mov	scan_no,#15d
  417   01B1   21 C3           		ajmp	out_scanner
  418                          	;----------------------------------------------------------------------
  419                          	
  420                          	;-(15(f))--------------------------------------------------------------
  421   01B3                   	fifteen:
  422   01B3   B4 0F 08        		cjne	a,#15d,dummy		;
  423                          	;----------------------------------------
  424   01B6   12 02 04        		call	disp_blank
  425                          	;----------------------------------------
  426   01B9   A2 A7           		mov	c,krl4
  427   01BB   12 01 C4        		call	k
  428                          	;----------------------------------------
  429   01BE   75 38 00        	dummy:	mov	scan_no,#00d
  430   01C1   21 C3           		ajmp	out_scanner
  431                          	;----------------------------------------------------------------------
  432                          	
  433                          	
  434                          	;----------------------------------------------------------------------
  435   01C3                   	out_scanner:
  436                          	;	
  437   01C3   22              		ret
  438                          	;-----------------------------------------------------------------------
  439                          	
  440                          	
  441                          	;-------------------------------------------------
  442                          	;comes with c flag having the status of the corrosponding krl line.
  443   01C4                   	k:
  Wed Jun 14 2006 20:47                                                                                                  Page    9




  444   01C4   20 00 2A        		jb	key_ready,out_debounce
  445                          	;----------------------------------------
  446                          	;key detect....
  447   01C7   92 02           		mov	tb,c			;save carry bit
  448   01C9   E5 39           		mov	a,dcount
  449   01CB   B4 21 0C        		cjne	a,#33d,debounce
  450   01CE   A2 02           		mov	c,tb			;restore carry bit
  451   01D0   40 31           		jc	out_k
  452                          	;key pressed for the first time...
  453   01D2   15 39           		dec	dcount
  454   01D4   85 38 41        		mov	key_code,scan_no	;copy the scan_no in key_code
  455   01D7   02 02 03        		jmp	out_k
  456                          	;----------------------------------------	
  457   01DA                   	debounce:
  458   01DA   D5 39 26        		djnz	dcount,out_k
  459                          	;debounce complete..now check for key press...
  460   01DD   A2 02           		mov	c,tb			;restore carry bit
  461   01DF   40 0A           		jc	spurious_key
  462   01E1   75 39 21        		mov	dcount,#33d
  463   01E4   D2 00           		setb	key_ready		;key still pressed (after debounce)
  464   01E6   D2 03           		setb	start_buzzer		;buzzer on
  465   01E8   02 02 03        		jmp	out_k
  466   01EB                   	spurious_key:
  467   01EB   75 39 21        		mov	dcount,#33d
  468   01EE   02 02 03        		jmp	out_k
  469                          	
  470   01F1                   	out_debounce:
  471                          	;----------------------------------------
  472                          	;check for key release...
  473   01F1   40 06           		jc	l1_k
  474   01F3   75 40 20        		mov	krcount,#32d
  475   01F6   02 02 03        		jmp	out_k
  476   01F9                   	l1_k:
  477   01F9   D5 40 07        		djnz	krcount,out_k
  478   01FC   D2 01           		setb	nkp			;key release bit
  479   01FE   C2 03           		clr	start_buzzer		;buzzer off		
  480   0200   75 40 20        		mov	krcount,#32d
  481                          	;	jmp	out_k
  482                          	;----------------------------------------
  483   0203                   	out_k:
  484   0203   22              		ret		
  485                          	;----------------------------------------------------------------------
  486                          	
  487                          	
  488                          	
  489                          	;---------------------------------------------------
  490                          	;Subroutines here onwards...
  491                          	;disp_blank
  492                          	;adisp1,2,3,4
  493                          	;test_display
  494                          	;wait_1sec
  495                          	;wait_20ms
  496                          	;inc_d
  497                          	;key_release
  498                          	;---------------------------------------------------
  499   0204                   	disp_blank:
  500   0204   75 80 00        		mov 	p0,#00h
  Wed Jun 14 2006 20:47                                                                                                  Page   10




  501   0207   22              		ret
  502                          	;---------------------------------------------------
  503                          	
  504                          	;---------------------------------------------------
  505   0208                   	adisp1:
  506   0208   90 02 38        		mov 	dptr,#adisp_lut
  507   020B   E5 30           		mov 	a,ds1
  508   020D   C3              		clr	c
  509   020E   94 30           		subb	a,#"0"
  510   0210   93              		movc 	a,@a+dptr
  511   0211   F5 80           		mov 	p0,a
  512   0213   22              		ret
  513                          	
  514                          	;----------------------------------------
  515   0214                   	adisp2:
  516   0214   90 02 38        		mov 	dptr,#adisp_lut
  517   0217   E5 31           		mov 	a,ds2
  518   0219   C3              		clr	c
  519   021A   94 30           		subb	a,#"0"
  520   021C   93              		movc 	a,@a+dptr
  521   021D   F5 80           		mov 	p0,a
  522   021F   22              		ret
  523                          	
  524                          	;----------------------------------------
  525   0220                   	adisp3:
  526   0220   90 02 38        		mov 	dptr,#adisp_lut
  527   0223   E5 32           		mov 	a,ds3
  528   0225   C3              		clr	c
  529   0226   94 30           		subb	a,#"0"
  530   0228   93              		movc 	a,@a+dptr
  531   0229   F5 80           		mov 	p0,a
  532   022B   22              		ret
  533                          	
  534                          	;----------------------------------------
  535   022C                   	adisp4:
  536   022C   90 02 38        		mov 	dptr,#adisp_lut
  537   022F   E5 33           		mov 	a,ds4
  538   0231   C3              		clr	c
  539   0232   94 30           		subb	a,#"0"
  540   0234   93              		movc 	a,@a+dptr
  541   0235   F5 80           		mov 	p0,a
  542   0237   22              		ret
  543                          	
  544                          	;----------------------------------------
  545                          	
  546                          	;----------------------------------------
  547   0238                   	adisp_lut:
  548   0238   FC              		db 	11111100b	;0
  549   0239   60              		db 	01100000b	;1
  550   023A   DA              		db 	11011010b	;2
  551   023B   F2              		db 	11110010b	;3
  552   023C   66              		db 	01100110b	;4
  553   023D   B6              		db 	10110110b	;5
  554   023E   BE              		db 	10111110b	;6
  555   023F   E0              		db 	11100000b	;7
  556   0240   FE              		db 	11111110b	;8
  557   0241   F6              		db 	11110110b	;9
  Wed Jun 14 2006 20:47                                                                                                  Page   11




  558                          	;
  559   0242   00              		db	00000000b	;"9"+1 code for SPACE
  560   0243   FF              		db	11111111b	;3b
  561   0244   FF              		db	11111111b	;3c
  562   0245   FF              		db	11111111b	;3d
  563   0246   FF              		db	11111111b	;3e
  564   0247   FF              		db	11111111b	;3f
  565   0248   FF              		db	11111111b	;40
  566                          	;
  567   0249   EE              		db 	11101110b	;a
  568   024A   3E              		db 	00111110b	;b
  569   024B   9C              		db 	10011100b	;c
  570   024C   7A              		db 	01111010b	;d
  571   024D   9E              		db 	10011110b	;e			
  572   024E   8E              		db 	10001110b	;f
  573                          	
  574                          	;---------------------------------------------------
  575                          	
  576                          	;---------------------------------------------------
  577   024F                   	test_display:
  578   024F   75 30 3B        		mov	ds1,#"9"+2	;glow all segments
  579   0252   75 31 3B        		mov	ds2,#"9"+2
  580   0255   75 32 3B        		mov	ds3,#"9"+2
  581   0258   75 33 3B        		mov	ds4,#"9"+2
  582                          	;
  583   025B   12 02 6E        		call	wait_1sec
  584                          	;
  585   025E   75 30 3A        		mov	ds1,#"9"+1	;put off all segments
  586   0261   75 31 3A        		mov	ds2,#"9"+1
  587   0264   75 32 3A        		mov	ds3,#"9"+1
  588   0267   75 33 3A        		mov	ds4,#"9"+1
  589                          	;
  590   026A   12 02 6E        		call	wait_1sec
  591                          	;
  592   026D   22              		ret
  593                          	;---------------------------------------------------
  594                          	
  595                          	;---------------------------------------------------
  596   026E                   	wait_1sec:
  597   026E   75 36 07        		mov	dcount_3,#07d
  598   0271   75 35 FF        	l2:	mov 	dcount_2,#0ffh
  599   0274   75 34 FF        	l1:	mov 	dcount_1,#0ffh
  600   0277   D5 34 FD        		djnz 	dcount_1,$
  601   027A   D5 35 F7        		djnz 	dcount_2,l1
  602   027D   D5 36 F1        		djnz 	dcount_3,l2
  603   0280   22              		ret
  604                          	;---------------------------------------------------
  605                          	
  606                          	;---------------------------------------------------
  607   0281                   	wait_20ms:
  608   0281   75 35 55        		mov	dcount_2,#55h
  609   0284   75 34 FF        		mov	dcount_1,#0ffh		;$-3-3
  610   0287   D5 34 FD        		djnz	dcount_1,$		;$-3
  611   028A   D5 35 F7        		djnz	dcount_2,$-3-3
  612   028D   22              		ret
  613                          	;---------------------------------------------------
  614                          	
  Wed Jun 14 2006 20:47                                                                                                  Page   12




  615                          	;---------------------------------------------------
  616                          	;Increments value of ds4 ds3 ds2 ds1 considering as a single
  617                          	;four digit no from 0000 to 9999
  618   028E                   	inc_d:
  619   028E   05 30           		inc 	ds1
  620   0290   E5 30           		mov 	a,ds1
  621   0292   B4 3A 00        		cjne 	a,#"9"+1,$+3
  622   0295   50 01           		jnc 	l1_id 
  623   0297   22              		ret
  624                          	
  625                          	;----------------------------------------
  626   0298   75 30 30        	l1_id:	mov 	ds1,#"0"
  627   029B   05 31           		inc 	ds2
  628   029D   E5 31           		mov 	a,ds2
  629   029F   B4 3A 00        		cjne 	a,#"9"+1,$+3
  630   02A2   50 01           		jnc 	l2_id
  631   02A4   22              		ret
  632                          	
  633                          	;----------------------------------------
  634   02A5   75 31 30        	l2_id:	mov 	ds2,#"0"
  635   02A8   05 32           		inc 	ds3
  636   02AA   E5 32           		mov 	a,ds3
  637   02AC   B4 3A 00        		cjne 	a,#"9"+1,$+3 
  638   02AF   50 01           		jnc 	l3_id
  639   02B1   22              		ret
  640                          	
  641                          	;----------------------------------------
  642   02B2   75 32 30        	l3_id:	mov 	ds3,#"0"
  643   02B5   05 33           		inc 	ds4 
  644   02B7   E5 33           		mov 	a,ds4
  645   02B9   B4 3A 0C        		cjne 	a,#"9"+1,out_id
  646                          	;
  647   02BC   75 30 30        		mov	ds1,#"0"
  648   02BF   75 31 30        		mov	ds2,#"0"
  649   02C2   75 32 30        		mov	ds3,#"0"
  650   02C5   75 33 30        		mov	ds4,#"0"
  651                          	;
  652   02C8                   	out_id:
  653   02C8   22              		ret
  654                          	;---------------------------------------------------
  655                          	
  656                          	;---------------------------------------------------
  657   02C9                   	key_release:
  658   02C9   30 01 FD        		jnb	nkp,$		;wait for no key press flag
  659   02CC   C2 00           		clr	key_ready
  660   02CE   C2 01           		clr	nkp
  661   02D0   22              		ret
  662                          	;---------------------------------------------------
  663   02D1                   	buzzer:
  664   02D1   30 03 02        		jnb	start_buzzer,out_b
  665   02D4                   		
  666   02D4   B2 95           		cpl	P1.5
  667   02D6                   		
  668   02D6                   	out_b:
  669   02D6   22              		ret	
  670                          	
  671                          	;----------------------------------------------------------------------
  Wed Jun 14 2006 20:47                                                                                                  Page   13




  672   02D7                   		end
  Wed Jun 14 2006 20:47                                                                                                  Page   14


Defined            Symbol Name             Value                References

  505    adisp1                             0208          194
  515    adisp2                             0214          258
  525    adisp3                             0220          324
  535    adisp4                             022C          385
  547    adisp_lut                          0238          506    516    526    536
  103    ascii_tab                          0053           97
  Pre    BSECT                              0000      
  663    buzzer                             02D1          166
  Pre    CODE                               002B           47     50     53     56     60     66     70
   18    count                           =  0037      
  Pre    DATA                               0000      
   20    dcount                          =  0039          137    448    453    458    462    467
   14    dcount_1                        =  0034          599    600    609    610
   15    dcount_2                        =  0035          598    601    608    611
   16    dcount_3                        =  0036          597    602
  457    debounce                           01DA          449
  499    disp_blank                         0204          237    303    365    424
    9    ds1                             =  0030           87     99    124    507    578    585    619    620    626    647
   10    ds2                             =  0031           88    125    517    579    586    627    628    634    648
   11    ds3                             =  0032           89    126    527    580    587    635    636    642    649
   12    ds4                             =  0033           90    127    537    581    588    643    644    650
  429    dummy                              01BE          422
  315    eight                              013F          301
  362    eleven                             0171          349
  421    fifteen                            01B3          409
  270    five                               0115          250
  249    four                               00FD          235
  408    fourteen                           01A6          396
  618    inc_d                              028E      
  112    init                               0063           79
  123    init_display                       006D          114
  131    init_keypad                        007A          116
  148    init_timer0                        0092          118    165
  159    isr_t0                             00A0           54
  443    k                                  01C4          197    211    225    240    261    276    291    306    327    341    354
                                                          368    388    401    414    427
   22    key_code                        =  0041           95    454
   40    key_ready                       =  0000           94    139    444    463    659
  657    key_release                        02C9          100
   21    krcount                         =  0040          138    474    477    480
   35    krl1                            =  00A4          132    196    260    326    387
   36    krl2                            =  00A5          133    210    275    340    400
   37    krl3                            =  00A6          134    224    290    353    413
   38    krl4                            =  00A7          135    239    305    367    426
  599    l1                                 0274          601
  626    l1_id                              0298          622
  476    l1_k                               01F9          473
   92    l1_main                            0043          101
  598    l2                                 0271          602
  634    l2_id                              02A5          630
  642    l3_id                              02B2          638
   77    main                               002C           48
  335    nine                               0157          316
   41    nkp                             =  0001          140    478    658    660
  205    one                                00D3          185
  668    out_b                              02D6          664
  470    out_debounce                       01F1          444
  Wed Jun 14 2006 20:47                                                                                                  Page   15


Defined            Symbol Name             Value                References

  652    out_id                             02C8          645
  168    out_isr                            00B0      
  483    out_k                              0203          451    455    458    465    468    475    477
  435    out_scanner                        01C3          200    214    228    243    264    279    294    309    330    344    357
                                                          371    391    404    417    430
  Pre    RSECT                              0000      
  177    scanner                            00B9          167
   19    scan_no                         =  0038          136    179    199    213    227    242    263    278    293    308    329
                                                          343    356    370    390    403    416    429    454
  300    seven                              012F          286
  285    six                                0122          271
   30    sl1                             =  00A0          189    253    319    380
   31    sl2                             =  00A1          190    254    320    381
   32    sl3                             =  00A2          191    255    321    382
   33    sl4                             =  00A3          192    256    322    383
  466    spurious_key                       01EB          461
   43    start_buzzer                    =  0003          141    464    479    664
   42    tb                              =  0002          447    450    460
  348    ten                                0164          336
  577    test_display                       024F           83
  395    thirteen                           0199          377
  234    three                              00ED          220
   25    top_of_stack                    =  0060           78
  376    twelve                             0181          363
  219    two                                00E0          206
  596    wait_1sec                          026E          583    590
  607    wait_20ms                          0281      
  184    zero                               00BB      




           Lines Assembled :  672             Assembly Errors :  0


